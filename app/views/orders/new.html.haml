x!!!
%html
  %head
    %title Enviar fotos
    = stylesheet_link_tag    "application", media: "all"
    = javascript_include_tag "controllers/orders"
    = airbrake_javascript_notifier
    = csrf_meta_tags

  -# .normal, .sending
  %body#photos.normal

    #main

      %nav
        %ul
          %li= link_to "Cancelar envio", cancel_order_path(@order), confirm: "Tem certeza?", method: "post"

      - if user_signed_in?
        - if current_user.anonymous?
          = "Usuário anonimo (#{link_to "login", new_user_session_path})"
        - else
          =raw "#{current_user.email} (#{link_to "sair", destroy_user_session_path, method: "delete"})"


      :javascript
        $(function () {
          library.flash.session( { token: '#{current_user.authentication_token}' } );
          kuva.orders({
            order: #{raw @order.to_json},
            default_product: #{raw @products.first.to_json},
            products: #{raw @products.to_json},
            specifications: #{raw @specs.to_json}
          });

          $.extend(specification, #{raw Specification.to_h.to_json})
        });


      #main-add
        #add-button.add-files
          .action
            clique aqui para
            .main adicionar fotos
            do seu computador
          .alternative ou arraste e solte suas fotos aqui
          .formats Formatos suportados: BMP, GIF, JPG, PNG, TIFF

        .afterwards
          Depois você irá selecionar como quer cada foto:&nbsp;
          %u> tamanho
          ,
          %u papel
          e
          %u quantidade

      #gadgets.unselectable

        .gadget.ruler-pomp.loaded.paper-glossy.size-10x15.vertical.sizing
          .canvas
            %div{ style: "width: 167px; height: 250px; background-color: #FFBA00" }
            .pomp.size-pomp
              .dimension.height
                %span.count 15
                %span.unit  cm
              .dimension.width
                %span.count 10
                %span.unit  cm
            .pomp.paper-pomp
            .control.hideable.size{ rel: "tooltip", title: "Alterar tamanho" }
            .control.hideable.paper{ rel: "tooltip", title: "Papel brilhante<br /><small>clique para alterar</small>" }
            .control.hideable.duplicate{ rel: "tooltip", title: "Duplicar esta foto<br /><small>para impressão, em<br />outro tamanho ou<br />papel, da mesma foto</small>", data: { html: true, placement: "right" } }
            .control.count{ rel: "tooltip", title: "Quantidade", data: { placement: "bottom" } }
              .control.subcontrol.minus -
              .pomp
                %span.times> &times;
                %span.number 2
              .control.subcontrol.plus +
          .modal.modal-size
            .title Escolha um tamanho:
            .sizes
              %a.size.selected{ href: "javascript:void(0);" }
                10
                %span.times &times;
                15
                %span.unit cm
              %a.size{ href: "javascript:void(0);" }
                15
                %span.times &times;
                21
                %span.unit cm
            %a.back{ href: "javascript:void(0);" } ← voltar

        .gadget.ruler-pomp.loaded.paper-matte.size-15x21.vertical
          .canvas
            %div{ style: "width: 179px; height: 250px; background-color: #FFBA00" }
            .pomp.size-pomp
              .dimension.height
                %span.count 21
                %span.unit  cm
              .dimension.width
                %span.count 15
                %span.unit  cm
            .pomp.paper-pomp
            .control.hideable.size{ rel: "tooltip", title: "Alterar tamanho" }
            .control.hideable.paper{ rel: "tooltip", title: "Papel brilhante<br /><small>clique para alterar</small>" }
            .control.hideable.duplicate{ rel: "tooltip", title: "Duplicar esta foto<br /><small>para impressão, em<br />outro tamanho ou<br />papel, da mesma foto</small>", data: { html: true, placement: "right" } }
            .control.hideable.count{ rel: "tooltip", title: "Quantidade", data: { placement: "bottom" } }
              .control.subcontrol.minus -
              .pomp
                %span.times> &times;
                %span.number 1
              .control.subcontrol.plus +

        .gadget.ruler-pomp.loaded.paper-glossy.size-10x15.horizontal
          .canvas
            %div{ style: "width: 250px; height: 167px; background-color: #333" }
            .pomp.size-pomp
              .dimension.height
                %span.count 10
                %span.unit  cm
              .dimension.width
                %span.count 15
                %span.unit  cm
            .pomp.paper-pomp
            .control.hideable.size{ rel: "tooltip", title: "Alterar tamanho" }
            .control.hideable.paper{ rel: "tooltip", title: "Papel brilhante<br /><small>clique para alterar</small>" }
            .control.hideable.duplicate{ rel: "tooltip", title: "Duplicar esta foto<br /><small>para impressão, em<br />outro tamanho ou<br />papel, da mesma foto</small>", data: { html: true, placement: "right" } }
            .control.count{ rel: "tooltip", title: "Quantidade", data: { placement: "bottom" } }
              .control.subcontrol.minus -
              .pomp
                %span.times> &times;
                %span.number 2
              .control.subcontrol.plus +

        .gadget.ruler-pomp.loaded.paper-glossy.size-15x21.horizontal
          .canvas
            %div{ style: "width: 250px; height: 179px; background-color: #EEE" }
            .pomp.size-pomp
              .dimension.height
                %span.count 15
                %span.unit  cm
              .dimension.width
                %span.count 21
                %span.unit  cm
            .pomp.paper-pomp
            .control.hideable.size{ rel: "tooltip", title: "Alterar tamanho" }
            .control.hideable.paper{ rel: "tooltip", title: "Papel brilhante<br /><small>clique para alterar</small>" }
            .control.hideable.duplicate{ rel: "tooltip", title: "Duplicar esta foto<br /><small>para impressão, em<br />outro tamanho ou<br />papel, da mesma foto</small>", data: { html: true, placement: "right" } }
            .control.hideable.count{ rel: "tooltip", title: "Quantidade", data: { placement: "bottom" } }
              .control.subcontrol.minus -
              .pomp
                %span.times> &times;
                %span.number 1
              .control.subcontrol.plus +

        .gadget.ruler-pomp.loaded.paper-glossy.size-10x15.vertical.uploading
          .canvas
            %div{ style: "width: 167px; height: 250px; background-color: #FFBA00" }
            .pomp.size-pomp
              .dimension.height
                %span.count 15
                %span.unit  cm
              .dimension.width
                %span.count 10
                %span.unit  cm
            .pomp.paper-pomp
            .control.hideable.size{ rel: "tooltip", title: "Alterar tamanho" }
            .control.hideable.paper{ rel: "tooltip", title: "Papel brilhante<br /><small>clique para alterar</small>" }
            .control.hideable.duplicate{ rel: "tooltip", title: "Duplicar esta foto<br /><small>para impressão, em<br />outro tamanho ou<br />papel, da mesma foto</small>", data: { html: true, placement: "right" } }
            .control.count{ rel: "tooltip", title: "Quantidade", data: { placement: "bottom" } }
              .control.subcontrol.minus -
              .pomp
                %span.times> &times;
                %span.number 2
              .control.subcontrol.plus +
            .upload.bar


    #aside
      .sending
        .title Enviando fotos...
        .progress.progress-striped.active
          .bar{ style: "width: 40%" }
        .counter
          .numbers
            %span.done 2
            de
            %span.total 8
        .caution
          %b Atenção:
          mantenha a página aberta até que o envio seja concluído.

      .normal
        .header
          .add-files Adicionar mais fotos

        #summary.faded
          .item
            .block.count 15
            .block.times &times;
            .block.product
              .thumb= image_tag "generic-temporary-small-photo-pile.png"
              .name 10&times;15
          .item
            .block.count 7
            .block.times &times;
            .block.product
              .thumb= image_tag "generic-temporary-small-photo-pile.png"
              .name 15&times;21
          .item
            .block.count 2
            .block.times &times;
            .block.product
              .thumb= image_tag "generic-temporary-small-photo-pile.png"
              .name 20&times;30
          .divisor
          .total
            %span.unit  R$
            %span.count 20,76


        #end
          #end-confirmation.tooltip.left.in
            .tooltip-inner
              .question Está tudo certo para enviar suas fotos?
              %a.button.success{ :href => "javascript:void(0);" } Sim, enviar
              &nbsp;
              %a.not-yet{ :href => "javascript:void(0);" } Ainda não, quero voltar
            .tooltip-arrow
          %a.button.success.faded{ :href => "javascript:void(0);" }
            Enviar fotos
            %br
            %small e fechar pedido

        #cancel.faded
          %a{ :href => "javascript:void(0);" }
            = image_tag "x.png"
            cancelar pedido




    %script#gadget{ type: "text/x-jqote-template" }
      :plain
        <![CDATA[


          <div id="gadget-<*= this.id *>" class="gadget ruler-pomp">
            <div class="canvas">
              <div class="image">
                <img class="thumbnail" src="<*= this.source *>" title="<*= this.name *>" />
              </div>
              <div class="pomp size-pomp">
                <div class="dimension height">
                  <span class="count"></span>
                  <span class="unit">cm</span>
                </div>
                <div class="dimension width">
                  <span class="count"></span>
                  <span class="unit">cm</span>
                </div>
              </div>
              <div class="pomp paper-pomp"></div>
              <div class="control hideable size" rel="tooltip" data-original-title="Alterar tamanho"></div>
              <div class="control hideable paper" rel="tooltip" data-original-title="Papel brilhante&lt;br /&gt;&lt;small&gt;clique para alterar&lt;/small&gt;"></div>
              <div class="control hideable duplicate" data-html="" data-placement="right" rel="tooltip" data-original-title="Duplicar esta foto&lt;br /&gt;&lt;small&gt;para impressão, em&lt;br /&gt;outro tamanho ou&lt;br /&gt;papel, da mesma foto&lt;/small&gt;"></div>
              <div class="control hideable count" data-placement="bottom" rel="tooltip" data-original-title="Quantidade">
                <div class="control subcontrol minus">-</div>
                <div class="pomp"><span class="times">×</span><span class="number" data-text="photo.count"></span>
                </div>
                <div class="control subcontrol plus">+</div>
              </div>
              <div class="thumbnail bar"></div>
              <div class="upload bar"></div>
            </div>
            <div style="position: absolute; bottom: 50px; z-index: 1001;">
              #{ select :spec, :paper, Specification::PAPERS, {}, data: {value: 'specification.paper'} }
              #{ collection_select :photo, :product_id, @products, :id, :name, {}, data: {value: 'photo.product_id'} }
              #{ text_field_tag :count, 0, type: :number, data: {value: 'photo.count'} }
            </div>
          </div>
        ]]>



    #overlay.gadgets

    / move partial to an embed tag
    = render 'flash'


    :javascript
      document.write(unescape("%3Cscript src='//www.snapengage.com/snapabug.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">
      SnapABug.setLocale("pt");
      SnapABug.addButton("9ff774d2-ef25-42b2-b50a-3715b117bdfc","0","50%");
