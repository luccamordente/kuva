- content_for :id, :orders

.container-fluid

  .row-fluid
    .span12
      %h1
        Ordem:
        = @order.id




  .row-fluid

    .span9

      %p.unprintable
        %b Status:
        = labeled_status @order
        %span.status-actions.unprintable
          = link_to "Marcar como executada", 'javascript:void(0);', class: 'btn btn-mini btn-inverse disabled' if @order.executable?
          = link_to "Marcar como entregue" , 'javascript:void(0);', class: 'btn btn-mini btn-inverse disabled' if @order.deliverable?
      %p
        %b Cliente:
        = @order.user.try :name
      %br

      %p
        %b Observações:
        = @order.observations
      %br


      %ul.nav.nav-tabs
        %li.active
          %a{ data: { toggle: 'tab' }, href: '#simple'   } Simples
        %li
          %a{ data: { toggle: 'tab' }, href: '#advanced' } Avançado

      .tab-content
        - unless @order.photos.empty?
          %table#simple.table.table-striped.tab-pane.active
            %tr
              %th
              %th
              %th Tamanho
              %th Papel
              %th Preço unitário
              %th Preço total

            - @photos.each_pair do |specs, photos|
              - count = photos.sum(&:count)
              %tr
                %td= count
                %td &times;
                %td= specs[:product].name
                %td= t "photo.specs.paper.#{specs[:paper]}"
                %td= number_to_currency specs[:product].price
                %td= number_to_currency specs[:product].price * count


        - unless @order.photos.empty?
          %table#advanced.table.table-striped.tab-pane
            %tr
              %th
              %th
              %th Tamanho
              %th Papel
              %th Preço unitário
              %th Preço total
              %th Arquivo
              %th.visible-desktop

            - @order.photos.each do |photo|
              %tr
                %td= photo.count
                %td &times;
                %td= photo.product.name
                %td= t "photo.specs.paper.#{photo.specification.paper}"
                %td= number_to_currency photo.product.price
                %td= number_to_currency photo.product.price * photo.count
                %td= File.basename photo.image.image.current_path if photo.image.present? && photo.image.image.present?
                %td.visible-desktop
                  %div.btn-group
                    = link_to download_admin_order_photo_path(@order.id, photo.id),  class: "btn btn-primary #{ 'disabled' unless @order.downloadable? }", rel: 'tooltip', title: 'Clique para fazer download' do
                      %i.icon-download-alt.icon-white
                    - if photo.image.present? && photo.image.image.original.present?
                      .btn.btn-primary.dropdown-toggle{ data: { toggle: 'dropdown' }}
                        %span.caret
                      %ul.dropdown-menu
                        %li
                          = link_to download_admin_order_photo_path(@order.id, photo.id, original: true), class: "btn-link #{ 'disabled' unless @order.downloadable? }" do
                            %i.icon-download-alt
                            Original



      %p
        %b Total de impressões:
        = @total_count
      %p
        %b Preço:
        = number_to_currency @order.price

      %br
      %br




    .span3.unprintable

      .btn-group#download
        = link_to (@order.downloadable? ? download_admin_order_path(@order) : 'javascript:void(0);'), class: "btn btn-primary #{ 'disabled' unless @order.downloadable? }", rel: 'tooltip', title: 'Clique para fazer download' do
          %i.icon-download-alt.icon-white
          Download
        .btn.btn-primary.dropdown-toggle{ data: { toggle: 'dropdown' }}
          %span.caret
        %ul.dropdown-menu
          %li
            = link_to (@order.downloadable? ? download_admin_order_path(@order, originals: true) : 'javascript:void(0);'), class: "btn-link #{ 'disabled' unless @order.downloadable? }" do
              Originais

      &nbsp;
      = link_to (@order.downloadable? ? 'javascript:print();' : 'javascript:void(0);'), class: "btn #{ 'disabled' unless @order.downloadable?}", rel: 'tooltip', title: 'Clique para imprimir' do
        %i.icon-print
        Imprimir


      %br
      %br

      #meta.well
        %p
          %b Aberta em:
          %br
          = l @order.created_at, format: :medium
        %p
          %b Atualizado pela última vez em:
          %br
          =  l @order.updated_at, format: :medium
        - if @order.canceled?
          %p
            %b Cancelada em:
            %br
            =  l @order.canceled_at, format: :medium

        %br

        %p
          %b Início da seleção em:
          %br
          = l @order.progress_at , format: :medium  if @order.progress_at
        %p
          %b Fechada em:
          %br
          = l @order.closed_at   , format: :medium  if @order.closed_at
        %p
          %b Início da captura:
          %br
          = l @order.catching_at , format: :medium  if @order.catching_at
        %p
          %b Capturado em:
          %br
          = l @order.caught_at   , format: :medium  if @order.caught_at
        %p
          %b Pronta em:
          %br
          = l @order.ready_at    , format: :medium  if @order.ready_at
        %p
          %b Entregue em:
          %br
          = l @order.delivered_at, format: :medium  if @order.delivered_at

