
/*!
 * stylus-sprite
 * Copyright (c) 2012 Heitor Salazar
 * MIT Licensed
 */

/**
 * Module dependencies.
 */

var stylus = require('stylus')

exports = module.exports = plugin;

// conditionally expose canvas-based APIs.

/**
 * Library version.
 */

exports.version = '0.1.7';

/**
 * Stylus path.
 */

exports.path = __dirname;

/**
 * Return the plugin callback for stylus.
 *
 * @return {Function}
 * @api public
 */

function plugin() {
  return function (style) {
      style.include(__dirname);
      StylusSprite = require("stylus-sprite");

	  sprite = new StylusSprite( { output_file: "sprite.png" } );

	  define('sprite', function(filename, option_val) {
		  // preparation phase
		  return sprite.spritefunc(filename, option_val);
	  }).render(function(err, css) {
		  if (err) throw err;

		  // rendering phase
		  sprite.build(css, function(err, css) {
			  if (err) throw JSON.stringify(err);
			  console.log(css);
		  });
	  });
  }
}
